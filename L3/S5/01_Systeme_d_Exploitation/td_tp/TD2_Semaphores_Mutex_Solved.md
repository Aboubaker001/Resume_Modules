<div dir="rtl" align="right">

# TD 2: التزامن والسيمافورات (Synchronisation & Sémaphores)

تمارين حول كيفية استخدام السيمافورات لحل مشاكل التزامن الكلاسيكية.

---

## التمرين الأول: مشكلة القراء والكتاب (Lecteurs/Rédacteurs)

**السؤال:** لدينا قاعدة بيانات مشتركة. يمكن لعدة قراء القراءة في نفس الوقت، ولكن إذا أراد كاتب الكتابة، يجب أن يكون وحده.
أكمل الكود التالي باستخدام السيمافورات:

```c
Semaphore mutex = 1;
Semaphore db = 1;
int readcount = 0;

Rédacteur:
  wait(db);
  // الكتابة
  signal(db);

Lecteur:
  wait(mutex);
  readcount++;
  if (readcount == 1) wait(db);
  signal(mutex);
  // القراءة
  wait(mutex);
  readcount--;
  if (readcount == 0) signal(db);
  signal(mutex);
```

**المطلوب:** اشرح دور المتغير `readcount` والسيمافور `db`.

**الحل:**
- **readcount:** يحسب عدد القراء الموجودين حالياً.
- **db:** سيمافور يضمن الإقصاء المتبادل للكتاب. أول قارئ يدخل يحجز `db` لمنع الكتاب، وآخر قارئ يخرج يحرر `db` للسماح للكتاب بالدخول.

---

## التمرين الثاني: مشكلة الفلاسفة (Dîner des Philosophes)

**السؤال:** 5 فلاسفة يجلسون حول طاولة دائرية، بين كل اثنين شوكة واحدة. يحتاج الفيلسوف لشوكتين ليأكل.
1. ما هي المشكلة التي تحدث إذا التقط كل فيلسوف الشوكة التي على يمينه في نفس الوقت؟
2. اقترح حلاً لتجنب هذه المشكلة.

**الحل:**
1. **المشكلة:** سيحدث **Deadlock** (اختناق)، لأن كل فيلسوف سيمسك شوكة وينتظر الأخرى للأبد.
2. **الحل المقترح:** 
   - السماح لـ 4 فلاسفة فقط بالجلوس في نفس الوقت.
   - أو: الفيلسوف لا يلتقط الشوكة إلا إذا كانت الشوكتان متاحتين.
   - أو: الفلاسفة ذوو الأرقام الزوجية يبدأون باليمين، والفرادي يبدأون باليسار.

---

## التمرين الثالث: السيمافورات P و V

**السؤال:** إذا كانت القيمة الابتدائية للسيمافور $S = 2$. ما هي القيمة النهائية بعد تنفيذ العمليات التالية بالتوالي؟
`P(S), P(S), V(S), P(S), V(S), V(S), V(S)`

**الحل:**
1. البداية: $S = 2$
2. `P(S)` : $S = 1$
3. `P(S)` : $S = 0$
4. `V(S)` : $S = 1$
5. `P(S)` : $S = 0$
6. `V(S)` : $S = 1$
7. `V(S)` : $S = 2$
8. `V(S)` : $S = 3$
**القيمة النهائية هي 3.**

</div>
