<div dir="rtl" align="right">

# 05. الاختناق (Deadlock)

### 1️⃣ ملخص الفكرة
الاختناق (أو القفل الميت) هو حالة تتوقف فيها مجموعة من العمليات عن العمل لأن كل واحدة منها تنتظر مورداً تمسكه عملية أخرى في نفس المجموعة. لا يمكن لأي عملية الاستمرار دون تدخل خارجي.

---

### 2️⃣ شرح مفصل ومبسط

#### شروط كوفمان الأربعة (لازم توفرها جميعاً لحدوث Deadlock):
1. **Exclusion Mutuelle:** مورد واحد لا يمكن مشاركته (مثل الطابعة).
2. **Détention et Attente:** عملية تمسك مورداً وتنتظر الحصول على آخر.
3. **Non-préemption:** لا يمكن للنظام سحب المورد من العملية بالقوة.
4. **Attente Circulaire:** العملية P0 تنتظر P1، و P1 تنتظر P2... و Pn تنتظر P0.

#### طرق التعامل مع Deadlock:
- **الوقاية (Prévention):** كسر أحد شروط كوفمان الأربعة.
- **التجنب (Évitement):** استخدام خوارزمية البنكي (Banker's Algorithm) للتأكد من أن النظام سيبقى في "حالة آمنة" (Safe State).
- **الكشف والتعافي (Détection & Récupération):** السماح بحدوثه ثم اكتشافه وإلغاء إحدى العمليات.
- **التجاهل:** طريقة النعامة (Ostrich Algorithm) المستخدمة في معظم الأنظمة المكتبية.

---

### 3️⃣ خوارزمية البنكي (Banker's Algorithm)

تعتمد على مقارنة ما تحتاجه العملية بما هو متوفر:
- **Max:** أقصى ما قد تحتاجه العملية.
- **Allocation:** ما تملكه العملية حالياً.
- **Need:** ما تحتاجه لإكمال عملها (`Need = Max - Allocation`).
- **Available:** الموارد المتوفرة في النظام.

---

### 4️⃣ أمثلة تطبيقية
**سيناريو الجسر الضيق:**
سيارتان متقابلتان في جسر لا يسع إلا لسيارة واحدة. كل سيارة تنتظر الأخرى لتتراجع.
- **الحل:** تراجع إحدى السيارات (Preemption/Recovery).

---

### 5️⃣ نقاط مهمة للحفظ (Exam Tips)
- **Safe State:** حالة يضمن فيها النظام وجود تسلسل تنفيذ (Safe Sequence) ينهي كل العمليات.
- **Resource Allocation Graph (RAG):** إذا كان الرسم يحتوي على حلقة (Cycle)، فقد يكون هناك Deadlock (مؤكد في حالة الموارد الوحيدة).

---

### 6️⃣ تمرين امتحاني
**سؤال:** إذا كان لدينا 3 عمليات وكل واحدة تحتاج موردين من نفس النوع، كم عدد الموارد الأدنى في النظام لضمان عدم حدوث Deadlock أبداً؟

**تلميح للحل:** استخدم القاعدة: $R \ge \sum (Max_i - 1) + 1$. في هذه الحالة: $(2-1) + (2-1) + (2-1) + 1 = 4$ موارد.

</div>
