<div dir="rtl" align="right">

# 04. التزامن (Synchronisation)

### 1️⃣ ملخص الفكرة
عندما تشترك عدة عمليات في الوصول إلى بيانات مشتركة، قد يحدث تضارب يؤدي لنتائج خاطئة (Race Condition). التزامن هو مجموعة الأدوات التي تضمن وصولاً منظماً وآمناً لهذه البيانات.

---

### 2️⃣ شرح مفصل ومبسط

#### مشكلة المنطقة الحرجة (Section Critique)
هي جزء من البرنامج الذي يصل فيه المعالج لمورد مشترك (متغير، ملف، قاعدة بيانات).
**الشروط الثلاثة للحل الصحيح:**
1. **Exclusion Mutuelle:** إذا كانت P1 في منطقتها الحرجة، لا يمكن لـ P2 الدخول.
2. **Progrès:** إذا لم تكن أي عملية في المنطقة الحرجة، يجب أن يتم اختيار العملية التالية دون تأخير.
3. **Attente Bornée:** يجب أن يكون هناك حد أقصى لعدد المرات التي تدخل فيها العمليات الأخرى قبل عملية معينة.

#### أدوات التزامن:
- **Mutex (Mutual Exclusion):** قفل بسيط (Lock/Unlock).
- **Sémaphores:** متغير صحيح (S) يتم التعامل معه عبر عمليتين:
    - **P(S) أو Wait:** تنقص القيمة. إذا كانت سالبة، تنتظر العملية.
    - **V(S) أو Signal:** تزيد القيمة وتوقظ المنتظرين.

---

### 3️⃣ خوارزمية المنتج والمستهلك (Producteur/Consommateur)

```text
// باستخدام السيمافورات
Semaphore full = 0;  // عدد العناصر المملوءة
Semaphore empty = N; // عدد الأماكن الفارغة
Semaphore mutex = 1; // للإقصاء المتبادل

Producteur:
  wait(empty);
  wait(mutex);
  // إضافة عنصر للمخزن
  signal(mutex);
  signal(full);

Consommateur:
  wait(full);
  wait(mutex);
  // أخذ عنصر من المخزن
  signal(mutex);
  signal(empty);
```

---

### 4️⃣ أمثلة تطبيقية
- **حساب بنكي:** إذا حاول شخصان سحب المال في نفس اللحظة من نفس الحساب، يجب استخدام التزامن لضمان عدم سحب مبلغ أكبر من الرصيد.
- **الطابعة:** لا يمكن لعمليتين الطباعة في نفس الوقت، يجب أن تنتظر إحداهما الأخرى.

---

### 5️⃣ نقاط مهمة للحفظ (Exam Tips)
- **Race Condition:** الحالة التي تعتمد فيها النتيجة النهائية على ترتيب تنفيذ العمليات.
- **Atomic Operation:** العملية التي لا يمكن مقاطعتها (تنفذ كقطعة واحدة).
- **Deadlock vs Starvation:** في التزامن، قد تؤدي البرمجة الخاطئة للسيمافورات إلى قفل ميت.

---

### 6️⃣ تمرين امتحاني
**سؤال:** اشرح لماذا نحتاج لسيمافور `mutex` في مشكلة المنتج والمستهلك حتى لو استخدمنا `full` و `empty`؟

**تلميح للحل:** السيمافورات `full` و `empty` تدير الفراغ والامتلاء، بينما `mutex` يضمن أن عملية واحدة فقط تعدل في المخزن (Buffer) في نفس اللحظة لمنع تضارب البيانات.

</div>
